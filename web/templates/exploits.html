{% extends "base.html" %} {% block head %} {{ super() }}
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.21.0/ace.js"
  integrity="sha512-Fv048ivDjkHY/u2gRxmZCeewXHbP/f17sH3KPpyfkVlmNrbzR3EVVoEzLBoB44o3GRw7CRUobhrv5j0M0VaTFA=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
></script>
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.21.1/mode-python.min.js"
  integrity="sha512-DUdq0nHbbCHQMqQNALNivk5tAdpFWOpm3mplXDwBqIpXD6/vfgXp8fESbfsnePQT3jZKVI3mCbEQumz/S4IHPA=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer"
></script>
<script>
  var socket = io(window.location.host, { rememberTransport: false });
  socket.on('connect', function () {
      socket.emit('connected', {});
  });
  var logpath = ''
  {% for filename in filenames %}
  logpath = '../logs/exploits/' + '{{ filename }}'.split('.')[0] + '.log'
  socket.on(logpath, (file) => {
      document.getElementById('{{ filename }}').innerHTML = file;
  });
  {% endfor %}
</script>
<script>
  function dropHandler(ev) {
    ev.preventDefault();

    // Use DataTransfer interface to access the file(s)
    [ev.dataTransfer.files].forEach((file, i) => {
      // Add the file to the form
      document.getElementById("fileinput").files = file;
    });
    submit();
  }
</script>
<script>
  function dragOverHandler(ev) {
    ev.preventDefault();
    new_text =
      "flex justify-center w-full h-32 px-4 transition bg-primary rounded-md appearance-none cursor-pointer border-2 border-viola border-dashed";
    document.getElementById("dnd-box").setAttribute("class", new_text);
  }
</script>
<script>
  function dragLeaveHandler(ev) {
    new_text =
      "flex justify-center w-full h-32 px-4 transition bg-primary rounded-md appearance-none cursor-pointer hover:border-2 border-viola border-dashed";
    document.getElementById("dnd-box").setAttribute("class", new_text);
  }
</script>

<script>
  async function submit() {
    //console.log(document.getElementById("fileinput").files);
    //await new Promise(resolve => setTimeout(resolve, 3500));
    document.fileuploadform.submit();
  }
</script>
<script>
  function fileClickHandler(event) {
    var elem = event.target;
    var filename = elem.innerText;
    sessions[open_session] = editor.session;
    editor.setSession(sessions[filename]);
    open_session = filename;
    activeTab = filename;
    editor.resize();
  }
</script>
{% endblock %} {% block content %}
<div class="flex flex-row items-center" x-data="{activeTab: 'a'}">
  <div
    class="flex flex-col bg-primary items-center rounded-lg shadow mr-4 ml-4 h-[calc(80vh)]"
  >
    <ul id="hierarchy" onclick="fileClickHandler(event);" class="text-lg bold">
      {% for exploit_filename in filenames %}
      <li @click="activeTab = '{{ exploit_filename }}'">
        {{ exploit_filename }}
      </li>
      {% endfor %}
    </ul>
  <div></div>
    <!-- component -->
    <form
      action="http://localhost:5000/exploits"
      method="POST"
      enctype="multipart/form-data"
      name="fileuploadform"
      class="flex-auto"
    >
      <div
        id="dnd-box"
        class="flex justify-center w-40 h-32 px-4 transition bg-primary rounded-md appearance-none cursor-pointer hover:border-2 border-viola border-dashed focus:outline-none"
        ondrop="dropHandler(event);"
        ondragover="dragOverHandler(event);"
        ondragleave="dragLeaveHandler(event);"
      >
        <label>
          <span class="flex items-center space-x-2">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-6 h-6 text-secondary-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
              />
            </svg>
            <span class="font-medium text-secondary-600">
              Drop files to Attach, or
              <span class="text-viola hover:underline">browse</span>
            </span>
          </span>
          <input
            type="file"
            id="fileinput"
            name="exploit_file"
            class="hidden"
            accept=".py"
            oninput="submit();"
            multiple
          />
        </label>
      </div>
    </form>
  </div>

  <div class="flex-none relative w-[calc(45vw)]">
    <div
      id="editor"
      class="p-4 bg-primary rounded-lg shadow h-[calc(80vh)]"
    ></div>

    {#
    <button
      id="savebutton"
      class="absolute bottom-1 right-1 self-end px-4 py-2 text-white rounded-lg shadow mt-4 mr-4 transition bg-viola"
      onclick="saveButtonHandler();"
    >
      Save
    </button>
    #}
  </div>
  <script>
    editor = ace.edit("editor");
    editor.setReadOnly(true);  // DON'T FORGET TO REMOVE AFTER IMPLEMENTING THE FUNCTIONALITIES
    editor.setTheme("ace/theme/twilight");
    sessions = {};
    {% for filename in filenames %}
    sessions["{{ filename }}"] = ace.createEditSession(`{{ files[filename] | safe }}`);
    sessions["{{ filename }}"].setMode("ace/mode/python");
    {% endfor %}
    open_session = ace.createEditSession("");
  </script>

  {% for filename in filenames %}
  <div
    x-cloak
    x-show="activeTab === '{{ filename }}'"
    class="flex-none w-[calc(40vw)] h-[calc(80vh)] m-2 p-2 bg-primary rounded-lg shadow max-w-5xl overflow-scroll"
  >
    <pre><code id="{{ filename }}"></code></pre>
  </div>
  {% endfor %}
</div>
{% endblock %}
