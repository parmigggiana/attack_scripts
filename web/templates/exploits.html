{% extends "base.html" %} {% block head %} {{ super() }}
<script>
  function dropHandler(ev) {
    ev.preventDefault();

    // Use DataTransfer interface to access the file(s)
    [ev.dataTransfer.files].forEach((file, i) => {
      // Add the file to the form
      document.getElementById("fileinput").files = file;
    });
    submit();
  }
</script>
<script>
  function dragOverHandler(ev) {
    ev.preventDefault();
    new_text =
      "flex justify-center w-full h-32 px-4 transition bg-primary rounded-md appearance-none cursor-pointer border-2 border-viola border-dashed";
    document.getElementById("dnd-box").setAttribute("class", new_text);
  }
</script>
<script>
  function dragLeaveHandler(ev) {
    new_text =
      "flex justify-center w-full h-32 px-4 transition bg-primary rounded-md appearance-none cursor-pointer hover:border-2 border-viola border-dashed";
    document.getElementById("dnd-box").setAttribute("class", new_text);
  }
</script>

<script>
async function submit() {
  //console.log(document.getElementById("fileinput").files);
  //await new Promise(resolve => setTimeout(resolve, 3500));
  document.fileuploadform.submit();
}
</script>
<script>
  function folderClickHandler(event) {
    var elem = event.target;
    if (elem.tagName.toLowerCase() == "span" && elem !== event.currentTarget) {
      var type = elem.classList.contains("folder") ? "folder" : "file";
      if (type == "file") {
        alert("File accessed");
      }
      if (type == "folder") {
        var isexpanded = elem.dataset.isexpanded == "true";
        if (isexpanded) {
          elem.classList.remove("fa-folder-o");
          elem.classList.add("fa-folder");
        } else {
          elem.classList.remove("fa-folder");
          elem.classList.add("fa-folder-o");
        }
        elem.dataset.isexpanded = !isexpanded;

        var toggleelems = [].slice.call(elem.parentElement.children);
        var classnames = "file,foldercontainer,noitems".split(",");

        toggleelems.forEach(function (element) {
          if (
            classnames.some(function (val) {
              return element.classList.contains(val);
            })
          )
            element.style.display = isexpanded ? "none" : "block";
        });
      }
    }
  }
</script>
{% endblock %} {% block content %}

<ul id="hierarchy" onclick="folderClickHandler(event);">
  {% for exploit_file in exploits %}
  <li>{{ exploit_file }}</li>
  {% endfor %}
</ul>

<div
  id="divisore_directory_or_drop"
  class="flex items-center justify-between gap-4 m-10"
>
  <!-- component -->
  <form
    action="http://localhost:5000/exploits"
    method="POST"
    enctype="multipart/form-data"
    name="fileuploadform"
  >
    <div
      id="dnd-box"
      class="flex justify-center w-full h-32 px-4 transition bg-primary rounded-md appearance-none cursor-pointer hover:border-2 border-viola border-dashed focus:outline-none"
      ondrop="dropHandler(event);"
      ondragover="dragOverHandler(event);"
      ondragleave="dragLeaveHandler(event);"
    >
      <label>
        <span class="flex items-center space-x-2">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-6 h-6 text-secondary-600"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"
            />
          </svg>
          <span class="font-medium text-secondary-600">
            Drop files to Attach, or
            <span class="text-viola hover:underline">browse</span>
          </span>
        </span>
        <input type="file" id="fileinput" name="exploit_file" class="hidden" accept=".py" oninput="submit();" multiple/>
      </label>
    </div>
  </form>
</div>
{% endblock %}
